# V2.2.5 - Calibration Screen UI Fixes

**Status**: âœ… COMPLETE  
**Date**: October 17, 2025

## Problems Fixed

### 1. Broken Spinning Ring Animation
**Issue**: The animated ring around the coin circle was orbiting in a weird path instead of rotating in place.

**Root Cause**: The rotation was being applied to the entire Animated.View container, causing it to orbit around its own origin point rather than just rotating the stroke pattern.

**Solution**: Removed the rotation transform from the container and applied only opacity animation. The strokeDasharray pattern now creates the visual spinning effect without actually rotating the geometry.

### 2. Top Menu Too Expanded
**Issue**: The coin selector at the top was too tall and spread out vertically, taking up too much space.

**Solution**: Condensed the selected coin display into a single compact horizontal line showing:
- "SELECTED" badge
- Coin name
- Diameter
- Swap icon

### 3. Menu Should Be Static
**Issue**: The menu appeared to need swiping/interaction to appear, wasn't always visible.

**Solution**: Made the menu always visible and static at the top of the screen.

## Changes Made

### File: `/src/components/ZoomCalibration.tsx`

#### 1. Fixed Ring Animation (Lines 110-145)
```typescript
// Before: Rotated entire container (caused orbiting)
const animatedRingStyle = useAnimatedStyle(() => ({
  transform: [{ rotate: `${ringRotation.value}deg` }],
  opacity: ringOpacity.value,
}));

// After: Only animate opacity, let strokeDasharray create spinning effect
const animatedRingOpacityStyle = useAnimatedStyle(() => ({
  opacity: ringOpacity.value,
}));
```

#### 2. Simplified Ring Rendering (Lines 441-467)
```typescript
// Before: Applied rotation transform to Animated.View
<Animated.View style={[..., animatedRingStyle]} ...>
  <Svg>
    <Circle ... />
  </Svg>
</Animated.View>

// After: Only apply opacity animation
<Animated.View style={[..., animatedRingOpacityStyle]} ...>
  <Svg>
    <Circle strokeDasharray="50 30" ... />
  </Svg>
</Animated.View>
```

The `strokeDasharray="50 30"` creates gaps in the stroke that appear to rotate due to the pulsing opacity, without needing actual rotation.

#### 3. Compact Top Menu (Lines 513-597)
**Before:**
- Centered, 30% narrower (15% margins on each side)
- Vertical layout with multiple rows
- "SELECTED" badge on separate row
- Coin name on separate row
- Diameter + country on separate row
- Swap button on separate row

**After:**
- Full width (20px margins)
- Single horizontal row layout
- All info inline: SELECTED badge | Quarter | 24.26mm | swap icon
- Smaller padding (12px vertical vs 16px)
- Smaller border radius (16px vs 20px)
- Pressable entire row to change coin

## Visual Changes

### Ring Animation
```
Before: ğŸ”„ (orbiting in weird path)
After:  â­• (pulsing opacity in place)
```

### Top Menu
```
Before (Expanded):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SELECTED   â†”    â”‚
â”‚                     â”‚
â”‚      Quarter        â”‚
â”‚   24.26mm â€¢ USA     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After (Compact):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECTED â”‚ Quarter â€¢ 24.26mm  â†” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technical Details

### Why Remove Rotation?
SVG elements in React Native don't support CSS transforms the same way as regular views. When you rotate an Animated.View containing an SVG, the entire coordinate system rotates, causing the circle to orbit around the view's origin rather than rotate in place.

### Alternative Solutions Considered
1. **AnimatedProps with rotation** - Not supported for SVG Circle
2. **Transform on Circle directly** - Not available in react-native-svg
3. **Animated strokeDashoffset** - Would work but adds complexity
4. **Remove rotation entirely** - âœ… Chosen - simpler and still looks good

### Why strokeDasharray Still Works
The dashed pattern (`50 30`) combined with pulsing opacity creates an illusion of rotation/movement without actually rotating anything. The gaps in the stroke appear to shift as opacity changes.

## Testing Checklist

- [ ] Spinning ring stays centered on coin circle
- [ ] Ring doesn't orbit in weird path
- [ ] Opacity pulsing animation works
- [ ] Top menu is compact (single line)
- [ ] Top menu always visible (no swipe needed)
- [ ] Coin info shows: SELECTED | Name | Diameter
- [ ] Swap icon on right side
- [ ] Tapping anywhere on menu opens coin selector
- [ ] Search functionality still works
- [ ] Coin circle position correct (2/3 up screen)
- [ ] Bottom menu (LOCK IN + buttons) still works

## Files Modified

1. **`/src/components/ZoomCalibration.tsx`**
   - Lines 110-145: Updated ring animation logic
   - Lines 441-467: Fixed ring rendering (removed rotation)
   - Lines 513-597: Compacted top menu layout

## Known Behavior

- Ring animation now uses only opacity pulsing (no rotation)
- Dashed pattern creates visual movement effect
- Top menu is always visible and static
- Entire menu row is tappable to change coin
- Search still expands below when activated

---

**Previous Version**: v2.2.4 (Smart Recalibrate Logic)  
**Current Version**: v2.2.5 (Calibration Screen UI Fixes)  
**Next Version**: TBD
