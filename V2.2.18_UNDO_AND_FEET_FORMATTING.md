# v2.2.18 - Undo Single Point & Feet/Inches Formatting

## Release Date
October 17, 2025

## Summary
Two quality-of-life improvements for measurement workflow and imperial unit display.

---

## ðŸŽ¯ Feature 1: Undo Single Point

### What Changed
**Before:** Tapping the undo button would delete an entire measurement
**After:** Tapping undo removes just the last point you placed

### How It Works
1. **When placing points** (e.g., setting corners of a rectangle):
   - First tap: Place first corner
   - Second tap: Start to place second corner
   - Tap undo: Removes just the second point, keeping the first one
   - Continue placing measurements without starting over

2. **Priority system:**
   - **Priority 1:** If you're currently placing points â†’ removes last point
   - **Priority 2:** If you have completed measurements â†’ reverts/deletes last measurement

### Example Use Cases
- **Rectangle measurement:** Place first corner, realize second corner is wrong, tap undo to fix just that point
- **Distance measurement:** Place first point, accidentally tap second point in wrong spot, undo removes just second point
- **Polygon building:** Build a complex shape point-by-point with confidence you can undo mistakes

### Technical Details
- **File Modified:** `/src/components/DimensionOverlay.tsx`
- **Function:** `handleClear()` (line ~2128)
- **Haptic:** Light impact when undoing a single point
- **Behavior:** Uses `currentPoints.slice(0, -1)` to remove only the last point

---

## ðŸ“ Feature 2: Feet/Inches Formatting

### What Changed
**Before:** `45.05 ft` (decimal feet)
**After:** `45'1"` (feet and inches)

### How It Works
When measurements are displayed in feet (imperial system), they now show as:
- `45'` (45 feet, 0 inches)
- `45'1"` (45 feet, 1 inch)
- `45'6"` (45 feet, 6 inches)
- `45'11"` (45.95 feet)
- `101'` (100.99 feet â†’ rounds to 101 feet)

### Where This Appears
1. **Coin calibration mode** - When using imperial system
2. **Map scale mode** - When map scale is set to feet
3. **All measurement types:**
   - Distance measurements
   - Rectangle dimensions
   - Circle diameters
   - Freehand perimeters
   - Polygon perimeters

### Technical Details
- **Files Modified:**
  - `/src/utils/unitConversion.ts` - `formatMeasurement()` function
  - `/src/components/DimensionOverlay.tsx` - `formatMapScaleDistance()` function
- **Rounding:** Converts to total inches first, then rounds to nearest inch
- **Logic:** `totalInches = round(feet * 12)`, then `displayFeet = floor(totalInches / 12)`, `displayInches = totalInches % 12`
- **Edge cases handled:**
  - 0 inches â†’ shows only feet (e.g., `45'`)
  - Values round to nearest inch (e.g., `45.95 ft` â†’ `45'11"`, `100.99 ft` â†’ `101'`)

---

## Testing Checklist

### Undo Single Point
- [ ] Place first point of rectangle â†’ tap undo â†’ first point removed
- [ ] Place 2 points of rectangle â†’ tap undo â†’ only second point removed
- [ ] Place 2 points of distance â†’ tap undo â†’ only second point removed
- [ ] Complete a measurement â†’ tap undo â†’ entire measurement deleted (existing behavior)
- [ ] Long-press undo â†’ rapidly deletes measurements (existing behavior)

### Feet/Inches Formatting
- [ ] Switch to imperial system
- [ ] Create distance measurement > 12 inches â†’ displays as `X'Y"`
- [ ] Create distance measurement exactly 12 inches â†’ displays as `1'`
- [ ] Create distance measurement with .5 feet â†’ displays as `X'6"`
- [ ] Switch to map scale mode with feet â†’ displays as `X'Y"`
- [ ] Create rectangle â†’ both dimensions show feet/inches format
- [ ] Create circle â†’ diameter shows feet/inches format

---

## Known Behaviors

### Undo Priority
The undo button now has a smart priority system:
1. **First priority:** Remove last placed point (if placing measurement)
2. **Second priority:** Revert edited measurement to original (if measurement was dragged)
3. **Third priority:** Delete completed measurement (if measurement was never edited)

### Feet Formatting Rules
- Values less than 12 inches still display as decimal inches (e.g., `11.50 in`)
- Values 12 inches or greater display as feet'inches" (e.g., `1'0"`)
- Metric measurements (mm, cm, m, km) are unaffected
- Miles and kilometers continue to use decimal format

---

## User Impact

### Positive Changes
âœ… More intuitive undo workflow - fix mistakes without starting over
âœ… Traditional imperial formatting - easier to read for construction/architecture
âœ… Matches real-world tape measure notation
âœ… No breaking changes - all existing features work the same

### No Negative Impact
- Metric users: No changes to behavior
- Existing measurements: All preserved and continue to work
- Performance: No impact (formatting is instant)

---

## Version History
- **v2.2.17** - Map scale UX improvement (removed auto-modal)
- **v2.2.18** - Undo single point + feet/inches formatting (current)

## Files Changed
1. `/src/components/DimensionOverlay.tsx` - Undo logic + map scale feet formatting
2. `/src/utils/unitConversion.ts` - Coin calibration feet formatting
